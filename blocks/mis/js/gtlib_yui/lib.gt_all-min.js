
YUI().use('yui2-dom','yui2-event','yui2-dragdrop',function(Y){var YAHOO=Y.YUI2;if(typeof(GTLib)=='undefined'){GTLib={version:2011042100,ExportFuncs:typeof(GTLib_ExportFuncs)!='undefined'?GTLib_ExportFuncs:false,Widget:{}};}
GTLib.Base={BindArguments:function(fn){var args=[];for(var n=1;n<arguments.length;n++)
args.push(arguments[n]);return function(){return fn.apply(this,args);};},ObjectCompare:function(object1,object2){if(object1==object2){return(true);}else{var atypes=['number','string','null','undefined'];for(var at=0;at<atypes.length;at++){var atype=atypes[at];if(typeof(object1)==atype||typeof(object2)==atype){return(false);}}}
var obj1nprops=0;for(var x in object1){obj1nprops++;}
var obj2nprops=0;for(var x in object2){obj2nprops++;}
if(obj1nprops!=obj2nprops||obj1nprops==0){return(false);}
for(var n in object1){if(typeof(object1[n])!='undefined'&&typeof(object2[n])!='undefined'){if(!GTLib.Base.ObjectCompare(object1[n],object2[n])){return(false);}}else{if(typeof(object1[n])=='undefined'&&typeof(object2[n])=='undefined'){return(true);}else{return(false);}}}
return(true);},ObjectPropsFromOptions:function(obj,options){var objprops=new Array();for(var p in obj){objprops[p]=true;}
for(var o in options){if(objprops[p]&&o.substr(0,1)!='_'&&o!="options"&&typeof(options[o])!='undefined'&&options[o]!=null){obj[o]=options[o];}}},Clone:function(obj){if(obj==null||typeof(obj)!='object'){return obj;}
var temp=new obj.constructor();for(var key in obj){temp[key]=GTLib.Base.Clone(obj[key]);}
return temp;}}
if(GTLib.ExportFuncs){BindArguments=GTLib.Base.BindArguments;ObjectCompare=GTLib.Base.ObjectCompare;}
GTLib.Browser={ie:navigator.appVersion.indexOf('MSIE')>-1,ie5:navigator.appVersion.indexOf('MSIE 5')>-1,ie6:navigator.appVersion.indexOf('MSIE 6')>-1,ie7:navigator.appVersion.indexOf('MSIE 7')>-1,ie8:navigator.appVersion.indexOf('MSIE 8')>-1,opera:navigator.userAgent.indexOf("Opera")>-1,safari:navigator.userAgent.indexOf("Safari")>-1,firefox:navigator.userAgent.indexOf("Firefox")>-1};GTLib.Array={search:function(needle,haystack){for(n=0;n<haystack.length;n++){if(needle===haystack[n]){return(n);}
if(GTLib.Base.ObjectCompare(needle,haystack[n])){return(n);}}
return(-1);},intPosKey:function(searchkey,haystack){var n=-1;for(var key in haystack){n++;if(searchkey===key){return(n);}}
return(-1);},isArray:function(testvar){return(testvar instanceof Array);}}
if(GTLib.ExportFuncs){arraySearch=GTLib.Array.search;isArray=GTLib.Array.isArray;}
GTLib.String={trim:function(s){var s=String(s);return s.replace(/^\s+|\s+$/,'');}}
if(GTLib.ExportFuncs){trim=GTLib.String.trim;}
GTLib.XML={TextToXMLObj:function(txt){try{var xmlObj=new ActiveXObject('Microsoft.XMLDOM');xmlObj.loadXML(txt);}catch(e){var xmlObj=new DOMParser().parseFromString(txt,'text/xml');}
return(xmlObj);},ChildrenByTag:function(node,chkTagName){if(node!==null&&typeof(node)!='undefined'&&node.childNodes){var nodes=node.childNodes;var retNodes=new Array();for(var c=0;c<=nodes.length;c++){var chkNd=nodes[c];if(chkNd!=null&&typeof(chkNd)!='undefined'){var thsTagName=chkNd.tagName;if(thsTagName==chkTagName){retNodes.push(chkNd);}}}
if(retNodes.length==0){return(null);}else{return(retNodes);}}else{return(null);}},FirstTagVal:function(nd,tagName){try{var nodeVal=nd.getElementsByTagName(tagName)[0].childNodes[0].nodeValue;}catch(e){return("");}
return(nodeVal);},FirstTagValUnpack:function(nd,tagName){var raw=GTLib.XML.FirstTagVal(nd,tagName);return(GTLib.XML.SafedUnpack(raw));},SafedUnpack:function(str){str=str.replace(/~~AMP~~/gi,'&');str=str.replace(/~~LT~~/gi,'<');str=str.replace(/~~GT~~/gi,'>');str=str.replace(/~~QT~~/gi,'"');str=str.replace(/~~AP~~/gi,'\'');return(str);},UnsafedPack:function(str){str=str.replace(/&/gi,'~~AMP~~');str=str.replace(/</gi,'~~LT~~');str=str.replace(/>/gi,'~~GT~~');str=str.replace(/"/gi,'~~QT~~');str=str.replace(/'/gi,'~~AP~~');return(str);}}
if(GTLib.ExportFuncs){TextToXMLObj=GTLib.XML.TextToXMLObj;XMLChildrenByTag=GTLib.XML.ChildrenByTag;XMLFirstTagVal=GTLib.XML.FirstTagVal;XMLFirstTagValUnpack=GTLib.XML.FirstTagValUnpack;XMLSafedUnpack=GTLib.XML.SafedUnpack;XMLUnsafedPack=GTLib.XML.UnsafedPack;}
GTLib.DOM={getEl:function(id){if(typeof(id)=="string"){return(document.getElementById(id));}else{return(id);}},getFieldVal:function(id,seperator,fname){var sep=seperator?seperator:"|";var el=GTLib.DOM.getEl(id);var opts=null;var val="";var cbs=null;if(!el||typeof(el)=='undefined'||el.id==''||(GTLib.Browser.ie&&el.innerHTML=='')){if(typeof(fname)!=='undefined'){el=document.forms[fname].elements[id];}else{el=document.forms[0].elements[id];}
if(!el){el=GTLib.DOM.getEl(id);}}
if(typeof(el)=='object'){if(typeof(el.type)=='undefined'&&typeof(el.nodeName)=='undefined'){var elmembers=el;el=el[0];}
if(el.type=='text'||el.type=='textarea'||el.type=='hidden'){return(el.value);}else if(el.type=='checkbox'||el.type=='radio'){if(elmembers&&elmembers.length){cbs=elmembers;}else{cbs=el;}
val="";for(c=0;c<cbs.length;c++){if(cbs[c].checked){val+=val!=""?sep:"";val+=cbs[c].value;}}
return(val);}else if(typeof(el.type)!='undefined'&&el.nodeName.toLowerCase()=='select'){opts=el.getElementsByTagName('option');val="";for(o=0;o<opts.length;o++){if(opts[o].selected){val+=val!=""?sep:"";val+=opts[o].value;}}
return(val);}}else if(el.nodeName.toLowerCase()=='select'){opts=el.getElementsByTagName('option');val="";for(o=0;o<opts.length;o++){if(opts[o].selected){val+=val!=""?sep:"";val+=opts[o].value;}}
return(val);}
return('');},setFieldVal:function(id,val,fname){var el=GTLib.DOM.getEl(id);if(!el||el.id==''){if(typeof(fname)!=='undefined'){var el=document.forms[fname].elements[id];}else{var el=document.forms[0].elements[id];}}
if(el.type=='select-one'||el.type=='select-multiple'||el.type=='select'){for(var o=0;o<el.options.length;o++){if(typeof(el.options[o])!=='undefined'&&el.options[o].value==val){el.options[o].selected='selected';}else if(el.type!='select-multiple'){el.options[o].selected='';}}}else if(el.type=='textarea'){el.innerHTML=val;el.value=val;}else{el.value=val;}},labelByFor:function(id,parentEl){var parentEl=typeof(parentEl)=='undefined'?document:parentEl;var labels=parentEl.getElementsByTagName('label');for(var l=0;l<labels.length;l++){var fr=labels[l].getAttribute('for');if(id==fr){return(labels[l]);}}},createEl:function(elType,opts){var elType=elType.toLowerCase();var el=document.createElement(elType);var opts=!opts?{}:opts;var applicable=['id','className','class','style','innerHTML','name','multiple'];for(var a=0;a<applicable.length;a++){if(opts[applicable[a]]){var attname=applicable[a];attname=attname=='className'?'class':attname;if(attname=='class'&&(GTLib.Browser.ie5||GTLib.Browser.ie6||GTLib.Browser.ie7)){attname='className';}
if(attname=='style'&&GTLib.Browser.ie){el.style.setAttribute('cssText',opts['style'],0);}else{el.setAttribute(attname,opts[applicable[a]]);}}}
if(opts.apply){if(opts.parent){parent.appendChild(el);}else{document.body.appendChild(el);}}
return(el);},unlinkedAnchor:function(opts){var a=GTLib.DOM.createEl('a',opts);a.href='#';a.onclick=function(){return(false)};return(a);},getElDims:function(el){return({h:el.offsetHeight,w:el.offsetWidth});},getElByTagAndClass:function(parent,tag,exactclasses){var els=new Array();var kids=parent.getElementsByTagName(tag);for(k=0;k<kids.length;k++){if(kids[k].className==exactclasses){els.push(kids[k]);}}
return(els);}}
if(GTLib.ExportFuncs){$GT=GTLib.DOM.getEl;$GTF=GTLib.DOM.getFieldVal;setFieldVal=GTLib.DOM.setFieldVal;createEl=GTLib.DOM.createEl;unlinkedAnchor=GTLib.DOM.unlinkedAnchor;labelByFor=GTLib.DOM.labelByFor;}
GTLib.Ajax={respTextInErrors:false,Post:function(uri,postData,callbacks,options){if(typeof(options)=='undefined'){options={};}
if(typeof(options.failOnUnload)=='undefined'){options.failOnUnload=false;}
if(typeof(options.noAJAXSupport)=='undefined'){options.noAJAXSupport='Your browser does not appear to support AJAX. You could download a modern standards compliant web browser - e.g. Firefox, Opera or Safari';}
if(typeof(options.retryMax)=='undefined'){options.retryMax=2;}
if(typeof(options.retryPass)=='undefined'){options.retryPass=0;}
var http;if(window.XMLHttpRequest){http=new XMLHttpRequest();if(http.overrideMimeType){http.overrideMimeType('text/xml');}}else if(window.ActiveXObject){try{http=new ActiveXObject("Msxml2.XMLHTTP");}catch(e){try{http=new ActiveXObject("Microsoft.XMLHTTP");}catch(e){}}}
if(!http){alert(options.noAJAXSupport);return false;}
var req={http:http,unloaded:false,wuri:window.location,uri:uri,postData:postData,callbacks:callbacks,options:options};req.http.onreadystatechange=function(){GTLib.Ajax._ResponseTriggerCallBack(req);};YAHOO.util.Event.addListener(window,'unload',function(){req.unloaded=true;});req.http.open('POST',uri,true);req.http.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");req.http.send(postData);},_ResponseTriggerCallBack:function(req){var http=req.http;req.readyState=http.readyState;if(http.readyState==4){if(http.status==200){req.responseText=http.responseText;req.responseXML=http.responseXML;req.callbacks.success(req);}else{window.setTimeout(function(){GTLib.Ajax._TriggerFailureCallBack(req);},1000);}}},_TriggerFailureCallBack:function(req){req.options.retryPass++;var retryPass=req.options.retryPass;var retryMax=req.options.retryMax;var failOnUnload=req.options.failOnUnload;var unload=false;if(req.unloaded==true){unload=true;}else if(req.wuri!=window.location){unload=true;}
if(retryPass<retryMax&&unload==false){GTLib.Ajax.Post(req.uri,req.postData,req.callbacks,req.options);}else{if(unload==false||failOnUnload){req.callbacks.failure(req);}}},CheckXMLCriticalErrors:function(xmlObj,report){var report=typeof(report)=='undefined'?true:report
var criticalError=XMLFirstTagValUnpack(xmlObj,'critical_error');if(report){if(criticalError){var dg=new Dialog("<span class='title_error'>Error - Critical Error</span>","<div class='body_error'></div>"+criticalError,{buttons:[{name:'Close',functCode:function(){dg.CloseDialog();}}],lightBox:true,w:280,h:220,zIndex:2000});dg.Init();return(criticalError);}}
return(criticalError);},ResponseToDomXML:function(http){var response=http.responseText;try{var xmlDomObj=new ActiveXObject('Microsoft.XMLDOM');xmlDomObj.loadXML(response);}catch(e){var xmlDomObj=new DOMParser().parseFromString(response,'text/xml');}
return(xmlDomObj.documentElement);},ResponseToDomXMLValidate:function(http,resptype,reporterrors){var resp=GTLib.Ajax.ResponseToDomXML(http);var criticalError=GTLib.Ajax.CheckXMLCriticalErrors(resp,reporterrors);if(criticalError){return({resp:resp,error:criticalError});}
var respTypeCheck=XMLFirstTagVal(resp,'response_type');if(respTypeCheck!=resptype){var resptxterr=GTLib.Ajax.respTextInErrors?'  '+http.responseText:'';var respError='Error: unrecognised response received - expected '+resptype+' but received '+respTypeCheck+resptxterr;if(reporterrors){alert(respError);}
return({resp:resp,error:respError});}
return({resp:resp,error:false});}};if(GTLib.ExportFuncs){AJAXResponseToDomXML=GTLib.Ajax.ResponseToDomXML;AJAXPost=function(uri,postData,callbacks,options){GTLib.Ajax.Post(uri,postData,callbacks,options)};AJAXCheckXMLCriticalErrors=GTLib.Ajax.CheckXMLCriticalErrors;AJAXResponseToDomXMLValidate=GTLib.Ajax.ResponseToDomXMLValidate;}
GTLib.DD={ZIndex:function(id,sGroup,config){GTLib.DD.ZIndex.superclass.constructor.apply(this,arguments);}};YAHOO.lang.extend(GTLib.DD.ZIndex,YAHOO.util.DD,{origZ:0,startDrag:function(x,y){YAHOO.log(this.id+" startDrag","info","example");var style=this.getEl().style;this.origZ=style.zIndex;style.zIndex=this.config.dragZ;},endDrag:function(e){this.getEl().style.zIndex=this.origZ;}});GTLib.Form={applyFilterKeys:function(fieldId,lists){var field=GTLib.DOM.getEl(fieldId);field.onkeypress=function(e){return(GTLib.Form._filterKeys(e,lists))};},_filterKeys:function(e,lists){ev=(window.event)?event:e;if(window.event){var keyCode=ev.keyCode;}else{var keyCode=ev.charCode;}
var ecd=String.fromCharCode(keyCode);if(!keyCode){return true;}
var keyValid=keyCode;if(typeof(lists.blacklist)!='undefined'){if(GTLib.Array.isArray((lists.blacklist))){if(GTLib.Array.search(ecd,lists.blacklist)>-1){keyValid=false;}}}
if(typeof(lists.whitelist)!='undefined'){if(GTLib.Array.isArray((lists.whitelist))){if(GTLib.Array.search(ecd,lists.whitelist)==-1){keyValid=false;}}}
return(keyValid);},makeAjaxSendStr:function(form){var inps=form.getElementsByTagName('input');var sels=form.getElementsByTagName('select');var tas=form.getElementsByTagName('textarea');var sendstr='';sendstr=GTLib.Form._buildSendStr(sendstr,inps);sendstr=GTLib.Form._buildSendStr(sendstr,sels);sendstr=GTLib.Form._buildSendStr(sendstr,tas);return(sendstr);},_buildSendStr:function(sendstr,elarray){for(var i=0;i<elarray.length;i++){var el=elarray[i];if(el.id||el.name){sendstr+=sendstr==''?'':'&';var name=el.id?el.id:el.name;var fldval=$GTF(name);if(fldval){sendstr+=name+'='+fldval.replace(/&/g,'~~AMP~~');}}}
return(sendstr);}}
if(GTLib.ExportFuncs){formMakeAjaxSendStr=GTLib.Form.makeAjaxSendStr;applyFilterKeys=GTLib.Form.applyFilterKeys;}
GTLib.Moodle={get_string:function(identifier,module,a){if(typeof(moodle_lang[module])!='undefined'&&moodle_lang[module]!=null){if(typeof(moodle_lang[module][identifier])!='undefined'&&moodle_lang[module][identifier]!=null){var output=moodle_lang[module][identifier];output=output.replace(/\$a/g,a);}
return(output);}else{return('['+identifier+']');}}}
GTLib.Widget.AJAJTree=function(el,treeURL){if(typeof(createEl)=='undefined'){var createEl=GTLib.DOM.createEl;}
var me={constructor:function(el,treeURL){this.treeURL=treeURL;this.domObj;this.def_kids_req;this.elName;this.respObj;this.AJAX_url_root;this.currentId;this.docsSelectable;this.foldersSelectable;this.rootSelectable;this.selectedNodes;this.multiSelect;this.rootTitle;this.rootImgClass;this.w;this.h;this.ldText='Please wait. Loading Tree...';this.debug=false;this.selectedNodes=new Array();if(this.AJAX_url_root){this.AJAX_url_root=this.closeRootURL(AJAX_url_root);}else{this.AJAX_url_root="";}
this.domObj=$GT(el);if(this.domObj){this.w=parseInt(this.domObj.offsetWidth);this.h=parseInt(this.domObj.offsetHeight);this.elName=this.domObj.id;}else{this.elName=el;this.w=!this.w?100:parseInt(this.w);this.h=!this.h?false:parseInt(this.h);}},init:function(){if(!this.domObj){this.domObj=createEl('div',{id:this.elName,'class':'DHTMLTreeContainer'});this.domObj.style.width=this.w+"px";if(this.h){this.domObj.style.height=this.h+"px";}
document.body.appendChild(this.domObj);}
if(this.multiSelect){if(!this.docsSelectable&&!this.foldersSelectable){this.docsSelectable=true;}}
var ldCont=GTLib.DOM.createEl('div',{id:this.elName+'_loader','class':'mainLoader'});var ldText=GTLib.DOM.createEl('div',{'style':'position:relative'});var ldImg=GTLib.DOM.createEl('div',{'class':'imgLoaderBar'});ldText.innerHTML=this.ldText;ldCont.appendChild(ldText);ldCont.appendChild(ldImg,{});this.domObj.appendChild(ldCont);this.requestTree();this.rootImgClass=!this.rootImgClass?"root_def":this.rootImgClass;},closeRootURL:function(url){if(url!=""){if(url.charAt(url.length-1)!="/"){url=url+"/";}}
return(url);},URLHasProtocol:function(url){return(url.indexOf('http://')>-1||url.indexOf('https://')>-1);},requestTree:function(){var me=this;AJAXPost(this.treeURL,'',{success:function(o){me.LoadTreeData(o)},failure:function(){alert('failed '+me.treeURL)}})},HandleErrorDHTML:function(id){var ldDiv=$GT(this.elName+"_"+"ldr_"+id);if(ldDiv){var parent=ldDiv.parentNode;parent.removeChild(ldDiv);}},LoadTreeData:function(o){this.domObj.removeChild($GT(this.elName+'_loader'));if(this.debug){}
eval(o.responseText);if(response.criticalError){alert('The following critical error has occurred:'+response.criticalError);}
this.respObj=response;if(response.criticalError){alert(response.criticalError);return(false);}
if(response.type!="dhtml_tree"){alert('error - response is not for a dhtml tree');return;}
this.def_kids_req=trim(response.kidsAjax);treeUl=createEl('ul',{id:this.elName+"_tree"});treeUl.style.minWidth=(this.w-2)+"px";treeUl.style.clear='both';treeUl.style.overflow="visible";treeUl.className='DHTMLTree';this.domObj.appendChild(treeUl);if(this.rootTitle){this.addRootTitle();}
this.ParseTreeBranch(this.respObj,0,treeUl);var el=$GT(this.elName+"_tree");},addRootTitle:function(){var idpfx=this.elName+"_";var nodeLi=createEl('li',{id:idpfx+'root','class':'nodeLi'});if(GTLib.Browser.ie){nodeLi.style.height=nodeLi.style.minHeight;}
var nid=-1;var imgDiv=createEl('div',{id:idpfx+"img_"+nid,'class':'treenode '+this.rootImgClass});var txtDiv=createEl('div',{id:idpfx+"txt_"+nid,'class':'nodeTxt'});txtDiv.innerHTML=this.rootTitle;var dragDiv=createEl('div',{style:'position:relative; float:left','class':'dragDiv'});treeUl.appendChild(nodeLi);dragDiv.appendChild(imgDiv);dragDiv.appendChild(txtDiv);nodeLi.appendChild(dragDiv);this.ApplyNodeEvents('root',nid,txtDiv);return(nodeLi);},GetNodeById:function(node,id){var chkId=this.GetNodeId(node);if(chkId==id){return(node);}
if(!node.data||node.data==null){return(false);}
var kids=node.data;for(var c=0;c<=kids.length;c++){var kid=kids[c];if(kid!=null){var kidId=this.GetNodeId(kid);if(kidId==id){return(kid);}
var foundNode=this.GetNodeById(kid,id);if(foundNode){return(foundNode);}}}
return(false);},LoadBranchData:function(o){if(this.debug){}
eval(o.responseText);if(response.criticalError){alert(response.criticalError);return(false);}
var branchData=response.data;var branchPId=trim(response.branchParent);branchPId=this.deTokenise(branchPId);var parentNode=this.GetNodeById(this.respObj,branchPId);var parentNode=this.removeChildNodes(parentNode);var parentNode=this.addChildNodes(parentNode,branchData);var dNode=$GT(this.elName+"_"+branchPId);depth=this.nodeDepth(parentNode);var kUl=$GT(this.elName+"_"+"kids_"+branchPId);this.ParseTreeBranch(parentNode,depth+1,kUl);this.openFolderDisp(branchPId);var ldDiv=$GT(this.elName+"_"+"ldr_"+branchPId);var parent=ldDiv.parentNode;parent.removeChild(ldDiv);},isLastNodeInBranch:function(node){var pnode=node.parentNode;if(typeof(pnode.tagName)=="undefined"){return(false);}
var nodes=pnode.childNodes;var lastNode=this.getLastNode(nodes);if(node==lastNode){return(true);}else{return(false);}},getLastNode:function(nodes){for(n=nodes.length-1;n>0;n--){if(nodes[n].tagName=='node'){return(nodes[n]);}}
return(false);},nodeDepth:function(node){var depth=0;var pnode=node;do{var pnode=pnode.parent;depth=depth+1;}while(pnode)
return(depth);},treeUl:function(){return($GT(this.elName));},addChildNodes:function(node,children){node.data=children;return(node);},removeChildNodes:function(node){node.data=null;return(node);},ParseTreeBranch:function(branch,depth,appendTo){var nodes=branch.data;if(nodes==null){return;}
for(var n=0;n<=nodes.length;n++){if(nodes[n]!=null){var nid=this.ApplyNodeId(nodes[n],depth,n);this.WriteTreeItem(nodes[n],depth,nid,appendTo,nodes.length-1);}}},ApplyNodeId:function(node,depth,n){var nid=this.GetNodeId(node);if(nid==""){var nid=depth+"_"+n;node.id=nid;}
return(nid);},GetNodeId:function(node){try{var id=node.id;}catch(e){var id="";}
return(id);},WriteTreeItem:function(node,depth,nid,appendTo,numNodes){var idpfx=this.elName+"_";var nodename=node.name;var nodetype=node.type;var nodelink=node.linkId?node.linkId:-1;var linkAppend=nodelink!=-1?"linked":"";var nodetypecss=nodetype+linkAppend;if(nodetype=="file"){var nodeext=""+node.extension;var usenodeext=" ext_"+nodeext;}else{var usenodeext="";}
switch(nodetype){case"doc":var brCls="branch leaf";break;case"link":var brCls="branch leaf";break;case"file":var brCls="branch leaf";break;case"folder":var brCls="branch node";break;}
var nodeLi=createEl('li',{id:idpfx+nid,'class':'nodeLi'});var branchDiv=createEl('div',{id:idpfx+"branch_"+nid,'class':brCls});var dragDiv=createEl('div',{style:'position:relative; float:left','class':'dragDiv'});var imgDiv=createEl('div',{id:idpfx+"img_"+nid,'class':'treenode img_'+nodetypecss+usenodeext});var txtDiv=createEl('div',{id:idpfx+"txt_"+nid,'class':'nodeTxt'});txtDiv.innerHTML=nodename;this.ApplyNodeEvents(nodetype,nid,txtDiv);appendTo.appendChild(nodeLi);dragDiv.appendChild(imgDiv);dragDiv.appendChild(txtDiv);nodeLi.appendChild(branchDiv);nodeLi.appendChild(dragDiv);if(nodetype=="folder"){this.ApplyFolderEvent(node,branchDiv);this.ApplyFolderEvent(node,imgDiv);var kidsUl=createEl('ul',{id:this.elName+"_"+"kids_"+nid,style:'display:none','class':'branchContainer'});nodeLi.appendChild(kidsUl);if(!node.newNode){this.ParseTreeBranch(node,depth+1,kidsUl);}}
return({nodeLi:nodeLi,dragDiv:dragDiv});},FolderIsOpen:function(el){if(el.className!='nodeLi'){return(false);}
var id=el.id.replace(this.elName+"_","");var branch=$GT(this.elName+"_"+"branch_"+id);if(!branch){return(false);}
if(hasElementClass(branch,"node_exp")||hasElementClass(branch,"node_exp_end")){return(true);}},TreeNodeText:function(treeNode){var txtNode=getFirstElementByTagAndClassName('div','nodeTxt',treeNode);return(txtNode.innerHTML);},VisChildrenByTagAndClass:function(parent,tag,className,visibility){var kids=getElementsByTagAndClassName(tag,className,parent);for(k=0;k<kids.length;k++){var kid=kids[k];kid.style.visibility=visibility;}},ApplyFolderEvent:function(node,clickDiv){var me=this;YAHOO.util.Event.addListener(clickDiv,'click',function(){me.folderClicked(node)});},ApplyNodeEvents:function(nodetype,nid,txtDiv){var me=this;var apply=false;if(nodetype=="folder"&&this.foldersSelectable){apply=true;}else if(nodetype=="root"&&this.rootSelectable){apply=true;}else if(nodetype=="doc"&&this.docsSelectable){apply=true;}
if(apply){YAHOO.util.Event.addListener(txtDiv,'mousedown',function(e){me.NodeMouseDown(e,nid)});}},NodeMouseDown:function(e,id){if(!e)var e=window.event;var treeUl=$GT(this.elName);var txtDiv=$GT(this.elName+"_"+"txt_"+id);if(!txtDiv){return;}
if(txtDiv.className.indexOf("_selected")==-1){this.doSelect(txtDiv,id);}else{if(e.which){var rightclick=(e.which==3);}else if(e.button){var rightclick=(e.button==2);}
if(!rightclick){this.doDeSelect(txtDiv,id);}}},doSelect:function(txtDiv,id){if(!this.multiSelect){if(this.selectedNodes[0]){var prevNodeId=this.selectedNodes[0];var prevNode=$GT(this.elName+"_"+"txt_"+prevNodeId);this.doDeSelect(prevNode,prevNodeId);}}
txtDiv.className=txtDiv.className.replace("_hover","");txtDiv.className=txtDiv.className+"_selected";this.selectedNodes.push(id);},arrayPos:function(arr,itm){for(a=0;a<=arr.length;a++){var chkitem=arr[a];if(typeof(chkitem)!="undefined"){if(chkitem==itm){return(a);}}}
return(-1);},doDeSelect:function(txtDiv,id){txtDiv.className=txtDiv.className.replace("_selected","");var aPos=this.arrayPos(this.selectedNodes,id);if(aPos>-1){this.selectedNodes.splice(aPos,1);}},folderClicked:function(node){if(node.state=="opened"){this.closeFolder(node);}else{this.openFolder(node);}
return;},openFolder:function(node){var nid=node.id;node.state="opened";if(node.data==null&&!node.newNode){this.openFolderAJAX(nid,node);}else{this.openFolderDisp(nid);}},openFolderById:function(id){var node=this.GetNodeById(this.respObj,id);this.openFolder(node);},appendToClassPreserveEnd:function(str,appStr){var addEnd=false;if(str.indexOf("_end")>-1){str=str.replace("_end","");var addEnd=true;}
str+=appStr;str+=addEnd?"_end":"";return(str);},openFolderDisp:function(nid){var branchDiv=$GT(this.elName+"_"+"branch_"+nid);branchDiv.className=this.appendToClassPreserveEnd(branchDiv.className,"_exp");var imgDiv=$GT(this.elName+"_"+"img_"+nid);imgDiv.className=imgDiv.className+"_exp";var kNode=$GT(this.elName+"_"+"kids_"+nid);kNode.style.display="block";},openFolderAJAX:function(nid,node){var imgDiv=$GT(this.elName+"_"+"img_"+nid);var dNode=$GT(this.elName+"_"+nid);var parDiv=imgDiv.parentNode.parentNode;var ldDiv=createEl('div',{id:this.elName+"_"+"ldr_"+nid});var depth=this.nodeDepth(node)+1;if(GTLib.Browser.ie){ldDiv.style.margin="0px 0px 0px 0px";ldDiv.style.border="0px none transparent";}else{ldDiv.style.margin="0px 0px 0px -1px";ldDiv.style.border="1px solid transparent";}
var csname=depth==0?"branch spacer":"branch";var txtDiv=createEl('div',{'class':'ajax_loader_text'});txtDiv.innerHTML="loading...";txtDiv.style.margin="0px 0px 0px 5px";var ldImgDiv=createEl('div',{'class':"imgLoader"});var kUl=$GT(this.elName+"_"+"kids_"+nid);if(!kUl){var kidsUl=createEl('ul',{id:this.elName+"_"+"kids_"+nid,'class':'branchContainer',style:'display:block'});dNode.appendChild(kidsDiv);}
kUl.style.display="block";ldDiv.appendChild(ldImgDiv);ldDiv.appendChild(txtDiv);ldDiv.style.height="16px";kUl.appendChild(ldDiv);var kids_req=node.kids_ajax_override?node.kids_ajax_override:this.def_kids_req;kids_req=this.convertTokens(kids_req,nid)
if(!this.URLHasProtocol(kids_req)){kids_req=this.AJAX_url_root+kids_req;}else{if(this.treeURL.indexOf('http://')>-1){kids_req=kids_req.replace('https://','http://');}else if(this.treeURL.indexOf('https://')>-1){kids_req=kids_req.replace('http://','https://');}}
var sendStr="pid="+this.tokenise(nid);var me=this;AJAXPost(kids_req,sendStr,{success:function(o){me.LoadBranchData(o);me.currentId=nid;},failure:function(){alert('failed: '+kids_req)}})},convertTokens:function(s,nid){var node=this.GetNodeById(this.respObj,nid);s=s.replace("[@id]",nid);s=this.deTokenise(s);if(node){s=this.extractNodeValues(s,node);}
return(s);},tokenise:function(s){s=String(s);s=s.replace("&","~~AMP~~");return(s);},deTokenise:function(s){s=String(s);s=s.replace("~~AMP~~","&");return(s);},extractNodeValues:function(s,node){var tmpArr=new Array();s=String(s);tmpArr=s.split("]");var newStr="";for(t=0;t<tmpArr.length-1;t++){var tmpStr=tmpArr[t];var niPos=tmpStr.indexOf("[#");if(niPos>-1){var nodeValNm=tmpStr.substring(niPos+2);var nodeVal=""+node.getElementsByTagName(nodeValNm)[0].childNodes[0].nodeValue;var noNode=tmpStr.substring(0,niPos);tmpArr[t]=noNode+nodeVal;}else{tmpArr[t]=tmpArr[t]+"]";}
newStr+=tmpArr[t];}
if(tmpArr.length-1==0){return(s);}
return(newStr);},closeFolder:function(node){var nid=node.id;var branchDiv=$GT(this.elName+"_"+"branch_"+nid);branchDiv.className=branchDiv.className.replace("_exp","");var imgDiv=$GT(this.elName+"_"+"img_"+nid);imgDiv.className=imgDiv.className.replace("_exp","");node.state="closed";var dNode=$GT(this.elName+"_"+"kids_"+nid);dNode.style.display="none";},closeFolderById:function(id){var node=this.GetNodeById(this.respObj,id);this.closeFolder(node);},getSelectedNodes:function(){var sv=new Array();for(s=0;s<this.selectedNodes.length;s++){var ndId=this.selectedNodes[s];var nd=this.GetNodeById(this.respObj,ndId);sv[s]=nd;}
return(sv);}}
me.constructor(el,treeURL);return(me);}
GTLib.Widget.Dialog=function(title,prompt,opts){this.x;this.y;this.w=300;this.h=200;this.title;this.prompt;this.buttons;this.id;this.domObj;this.preInitFunct;this.postInitFunct;this.preCloseClickFunct;this.postCloseClickFunct;this.preCloseFunct;this.postCloseFunct;this.postResizeFunct;this.lightBox;this.showXY=false;this.constrain=false;this.cssTheme="standard";this.zIndex;this.ldText='Please wait. Loading Data...';this.children=new Array();this.parentDialog;this.tbButtons={close:true,minmax:true};this.browser={ie:navigator.appVersion.indexOf('MSIE')>-1,ie6:navigator.appVersion.indexOf('MSIE 6')>-1,opera:navigator.userAgent.indexOf("Opera")>-1,firefox:navigator.userAgent.indexOf("Firefox")>-1};this._winDets;this._ddResize;this.Init=function(){if(me.id!=""&&$GT(me.id)){return(false);}
GTLib.Base.ObjectPropsFromOptions(me,opts);if(typeof(me.preInitFunct)=='function'){me.preInitFunct();}
me.updateWinDets();me.x=opts.x?opts.x:(parseInt(me._winDets.w)/2)-(parseInt(me.w)/2)+parseInt(me._winDets.x);me.y=opts.y?opts.y:(parseInt(me._winDets.y)+parseInt(me._winDets.h/2))-(parseInt(me.h)/2);me.title=title;me.prompt=prompt;me.buttons=typeof(opts.buttons)!='undefined'?opts.buttons:[{}];if(!me.zIndex){var tdia=me.getTopmostDialog();if(tdia){me.zIndex=tdia.zIndex+1;}else{me.zIndex=999;}}
if(typeof(GTLib_DialogTheme)!='undefined'){me.cssTheme=GTLib_DialogTheme;}
me.registerDialog();me.DrawDialog();if(typeof(me.postInitFunct)=='function'){me.postInitFunct();}
me.FixAllIEPngBGs();return(true);}
this.registerDialog=function(){if(typeof(GTLib.Widget.Dialogs)=='undefined'){GTLib.Widget.Dialogs=new Array();dlid=0;}else{dlid=GTLib.Widget.Dialogs.length;}
me.id=me.id?me.id:('dialog_'+dlid);GTLib.Widget.Dialogs[dlid]=me;}
this.unregisterDialog=function(){var apos=GTLib.Array.search(me,GTLib.Widget.Dialogs);if(apos==-1){return;}
GTLib.Widget.Dialogs.splice(apos,1);}
this.getTopmostDialog=function(lbox){var z=-1;var topdia=null;if(typeof(GTLib.Widget.Dialogs)=='undefined'){return(null);}
for(var d=0;d<GTLib.Widget.Dialogs.length;d++){var dia=GTLib.Widget.Dialogs[d];if(!lbox||dia.lightBox){if(dia.zIndex>=z){z=dia.zIndex;topdia=dia;}}}
return(topdia);}
this.updateWinDets=function(){var _winDets={x:YAHOO.util.Dom.getDocumentScrollLeft(),y:YAHOO.util.Dom.getDocumentScrollTop(),w:YAHOO.util.Dom.getViewportWidth(),h:YAHOO.util.Dom.getViewportHeight()};me._winDets=_winDets;return(_winDets);}
this.DrawDialog=function(){if(me.lightBox){var styleStr="left:0px;"+"top:0px;";if(this.browser.ie6){styleStr+="position:absolute!important;";var dh=YAHOO.util.Dom.getDocumentHeight();styleStr+="width:100%;height:"+dh+"px;";}else{styleStr+="position:fixed!important;";styleStr+="width:100%;height:100%;";}
styleStr+="z-index:"+(me.zIndex-1)+";";var darkDiv=$GT('darkDiv');if(!darkDiv){var darkDiv=GTLib.DOM.createEl('div',{id:'darkDiv',style:styleStr,'className':'lightBoxDarkDiv'});document.body.appendChild(darkDiv);}else{darkDiv.style.zIndex=me.zIndex;}}
var styleStr="";styleStr+="position:absolute;";styleStr+="left:"+me.x+"px;"+"top:"+me.y+"px;";styleStr+="width:"+me.w+"px;"+"height:"+me.h+"px;";var dialogContainer=GTLib.DOM.createEl('div',{id:me.id,style:styleStr});dialogContainer.style.zIndex=me.zIndex;me.domObj=dialogContainer;me.FixIE6FieldZIndexBug();var tlcorner=GTLib.DOM.createEl('div',{id:me.id+"_tlcorner",'className':'TopLeftCorner'});var trcorner=GTLib.DOM.createEl('div',{id:me.id+"_trcorner",'className':'TopRightCorner'});var blcorner=GTLib.DOM.createEl('div',{id:me.id+"_blcorner",'className':'BotLeftCorner'});var brcorner=GTLib.DOM.createEl('div',{id:me.id+"_brcorner",'className':'BotRightCorner'});dialogContainer.appendChild(tlcorner);dialogContainer.appendChild(trcorner);dialogContainer.appendChild(blcorner);dialogContainer.appendChild(brcorner);var toolBar=GTLib.DOM.createEl('div',{id:me.id+"_toolBar",'className':"DialogToolbar"});var toolBarTitle=GTLib.DOM.createEl('div',{id:me.id+"_toolBarTitle",'className':"DialogToolbarTitle"});toolBarTitle.innerHTML=me.title;toolBar.appendChild(toolBarTitle);var toolBarButtons=GTLib.DOM.createEl('div',{id:me.id+"_toolBarButtons",'className':"DialogToolbarButtons"});toolBar.appendChild(toolBarButtons);dialogContainer.appendChild(toolBar);var baseBar=GTLib.DOM.createEl('div',{id:me.id+"_baseBar",'className':"DialogBaseBar"});var baseBarInner=GTLib.DOM.createEl('div',{'className':"DialogBaseBarInner"});baseBar.appendChild(baseBarInner);dialogContainer.appendChild(baseBar);var dialogInner=GTLib.DOM.createEl('div',{id:me.id+"_inner",'className':'DialogInner'});dialogContainer.appendChild(dialogInner);var l_edge=GTLib.DOM.createEl('div',{id:me.id+"_l_edge",'className':'LeftEdge'});var r_edge=GTLib.DOM.createEl('div',{id:me.id+"_r_edge",'className':'RightEdge'});var b_edge=GTLib.DOM.createEl('div',{id:me.id+"_b_edge",'className':'BotEdge'});var t_edge=GTLib.DOM.createEl('div',{id:me.id+"_t_edge",'className':'TopEdge'});dialogContainer.appendChild(l_edge);dialogContainer.appendChild(r_edge);dialogContainer.appendChild(b_edge);dialogContainer.appendChild(t_edge);var prompt=GTLib.DOM.createEl('div',{id:me.id+"_prompt",'className':"DialogPrompt"});prompt.innerHTML=me.prompt;dialogInner.appendChild(prompt);var winDragContainer=GTLib.DOM.createEl('div',{id:me.id+"_winDragExpContainer",'className':"WindowDragExpContainer"});var winDrag=GTLib.DOM.createEl('div',{id:me.id+"_winDragExpander",'className':"WindowDragExpander"});winDrag.style.zIndex=(me.zIndex+1);winDragContainer.appendChild(winDrag);baseBar.appendChild(winDragContainer);this._ddResize=new GTLib.DD.ZIndex(me.id+"_winDragExpander","",{scroll:false,dragZ:me.zIndex+1});this._ddResize.onDrag=function(){me.Resize()};this._ddResize.setHandleElId(me.id+"_winDragExpander");if(me.showXY){var coords=GTLib.DOM.createEl('div',{id:me.id+"_coords",'className':"DialogCoords"});var posX=GTLib.DOM.createEl('div',{id:me.id+"_posX",'className':"PosX"});var posY=GTLib.DOM.createEl('div',{id:me.id+"_posY",'className':"PosY"});var sizeX=GTLib.DOM.createEl('div',{id:me.id+"_sizeX",'className':"SizeX"});var sizeY=GTLib.DOM.createEl('div',{id:me.id+"_sizeY",'className':"SizeY"});coords.appendChild(posX);coords.appendChild(posY);coords.appendChild(sizeX);coords.appendChild(sizeY);dialogInner.appendChild(coords);}
document.body.appendChild(dialogContainer);var dd=new GTLib.DD.ZIndex(dialogContainer.id,"",{scroll:false,dragZ:me.zIndex+1});dd.onDrag=function(){me.Moved()};dd.setHandleElId(me.id+"_toolBar");me.AddToolbarButtons();me.AddButtons(baseBar);dialogInner.style.height=(parseInt(dialogContainer.offsetHeight)-parseInt(toolBar.offsetHeight)-parseInt($GT(me.id+"_baseBar").offsetHeight))+"px";me.UpdateCoords();me.SetTheme(me.cssTheme);}
this.SetTheme=function(theme){me.cssTheme=theme;$GT(me.id).className=me.cssTheme+'_DW';setTimeout(function(){me.Resize()},5);if(GTLib.Browser.ie){setTimeout(function(){me.Resize()},100);}}
this.Moved=function(){if(me.constrain){var farX=parseInt(me.domObj.style.left)+parseInt(me.domObj.style.width);var farY=parseInt(me.domObj.style.top)+parseInt(me.domObj.style.height);if(farX<parseInt(me.domObj.style.width)){me.domObj.style.left="0px";}
if(farY<parseInt(me.domObj.style.height)){me.domObj.style.top="0px";}
if(farY>me._winDets.fullHeight){me.domObj.style.top=me._winDets.fullHeight-parseInt(me.domObj.style.height)+"px";}
if(this.browser.ie){var rPad=20;}else if(this.browser.opera){var rPad=10;}else if(this.browser.firefox){var rPad=4;}
if(farX>(me._winDets.fullWidth-rPad)){me.domObj.style.left=(me._winDets.fullWidth-parseInt(me.domObj.style.width))-rPad+"px";}
if(farY>me._winDets.fullHeight){me.domObj.style.top=me._winDets.fullHeight-parseInt(me.domObj.style.height);}}
me.UpdateCoords();}
this.Resize=function(){if(!$GT(me.id)){return;}
var toolBar=$GT(me.id+"_toolBar");var baseBar=$GT(me.id+"_baseBar");var winDrag=$GT(me.id+"_winDragExpander");var newWidth=parseInt(me.domObj.style.width)+parseInt(winDrag.offsetLeft);var newHeight=parseInt(me.domObj.style.height)+parseInt(winDrag.offsetTop);if(newWidth>50){me.domObj.style.width=newWidth+"px";}
if(newHeight>(toolBar.offsetHeight+baseBar.offsetHeight)){me.domObj.style.height=newHeight+"px";$GT(me.id+"_inner").style.height=(newHeight-parseInt($GT(me.id+"_toolBar").offsetHeight)-parseInt($GT(me.id+"_baseBar").offsetHeight))+"px";}
winDrag.style.left="0px";winDrag.style.top="0px";if(this._ddResize){this._ddResize.resetConstraints();}
me.UpdateCoords();me.SetEdgeDims();me.IE6ZIndexBugFrameResize();if(typeof(me.postResizeFunct)=='function'){me.postResizeFunct();}}
this.SetEdgeDims=function(){var dContDims=GTLib.DOM.getElDims(me.domObj);var tlc=$GT(me.id+"_tlcorner");var tlcDims=GTLib.DOM.getElDims(tlc);var trc=$GT(me.id+"_trcorner");var trcDims=GTLib.DOM.getElDims(trc);var blc=$GT(me.id+"_blcorner");var blcDims=GTLib.DOM.getElDims(blc);var brc=$GT(me.id+"_brcorner");var brcDims=GTLib.DOM.getElDims(brc);try{$GT(me.id+"_l_edge").style.height=((dContDims.h-tlcDims.h)-blcDims.h)+"px";$GT(me.id+"_l_edge").style.top=tlcDims.h+"px";$GT(me.id+"_r_edge").style.height=((dContDims.h-trcDims.h)-brcDims.h)+"px";$GT(me.id+"_r_edge").style.top=trcDims.h+"px";$GT(me.id+"_b_edge").style.width=((dContDims.w-blcDims.w)-brcDims.w)+"px";$GT(me.id+"_b_edge").style.left=blcDims.w+"px";$GT(me.id+"_t_edge").style.width=((dContDims.w-tlcDims.w)-trcDims.w)+"px";$GT(me.id+"_t_edge").style.left=tlcDims.w+"px";}catch(e){}}
this.UpdateCoords=function(){if(me.showXY){$GT(me.id+"_posX").innerHTML="x "+me.domObj.style.left;$GT(me.id+"_posY").innerHTML="y "+me.domObj.style.top;$GT(me.id+"_sizeX").innerHTML="w "+me.domObj.style.width;$GT(me.id+"_sizeY").innerHTML="h "+me.domObj.style.height;}}
this.AddToolbarButtons=function(){if(me.tbButtons.close){var closeBut=me.AddToolbarButton(me.id+"_close","DialogToolbarButton ButtonClose");if(typeof(me.preCloseClickFunct)=='function'){YAHOO.util.Event.addListener(closeBut,'click',function(){me.preCloseClickFunct()});}
YAHOO.util.Event.addListener(closeBut.id,'click',function(){me.CloseDialog()});if(typeof(me.postCloseClickFunct)=='function'){YAHOO.util.Event.addListener(closeBut,'click',function(){me.postCloseClickFunct()});}}
if(me.tbButtons.minmax){var maxBut=me.AddToolbarButton(me.id+"_maximise","DialogToolbarButton ButtonMax");YAHOO.util.Event.addListener(maxBut,'click',function(){me.MaximiseDialog()});var minBut=me.AddToolbarButton(me.id+"_minimise","DialogToolbarButton ButtonRest");minBut.style.display="none";YAHOO.util.Event.addListener(minBut,'click',function(){me.MinimiseDialog()});}}
this.AddToolbarButton=function(buttonId,buttonClass){var toolBarButtons=$GT(me.id+"_toolBarButtons");var but=GTLib.DOM.createEl('div',{id:buttonId,'className':buttonClass});YAHOO.util.Event.addListener(but,'mouseover',function(){me.IconButtonMouseOver(buttonId)});YAHOO.util.Event.addListener(but,'mouseout',function(){me.IconButtonMouseOut(buttonId)});toolBarButtons.appendChild(but);return(but);}
this.AddButtons=function(buttonParent){var butContainer=GTLib.DOM.createEl('div',{id:this.id+'_buttonContainer','className':'DialogButtonContainer'});buttonParent.appendChild(butContainer);for(var a=0;a<me.buttons.length;a++){var name=me.buttons[a].name;var butclass=me.buttons[a].butclass;var butstyle=me.buttons[a].butstyle?me.buttons[a].butstyle:'';if(typeof(butclass)=='undefined'){butclass='';}else{butclass=' '+butclass;}
var functCode=me.buttons[a].functCode;if(typeof(name)!='undefined'){var butId=me.buttons[a].butid?me.buttons[a].butid:me.id+"_button_"+a;var butInnerId=me.id+"_buttonInner_"+a;var but=GTLib.DOM.createEl('div',{id:butId,'className':'DialogButton'+butclass,style:butstyle});if(this.browser.ie6){but.style.width="20px";}
var butInner=GTLib.DOM.createEl('div',{id:butInnerId,'className':'DialogButtonInner'});butInner.innerHTML=name;but.appendChild(butInner);if(typeof(me.buttons[a].parent)=='undefined'){butContainer.appendChild(but);}else{$GT(me.buttons[a].parent).appendChild(but);}
this.AddButtonEvents(but,butId,butInnerId,functCode);}}}
this.AddButtonEvents=function(but,butId,butInnerId,cbClick){YAHOO.util.Event.addListener(but,'click',cbClick);YAHOO.util.Event.addListener(but,'mouseover',function(){me.ButtonMouseOver(butId,butInnerId)});YAHOO.util.Event.addListener(but,'mouseout',function(){me.ButtonMouseOut(butId,butInnerId)});}
this.ButtonMouseOver=function(butId,butInnerId){var but=$GT(butId);var butInner=$GT(butInnerId);but.className=but.className.replace('DialogButton','DialogButton_hover');butInner.className=butInner.className.replace('DialogButtonInner','DialogButtonInner_hover');}
this.ButtonMouseOut=function(butId,butInnerId){var but=$GT(butId);var butInner=$GT(butInnerId);but.className=but.className.replace("DialogButton_hover","DialogButton");butInner.className=butInner.className.replace("DialogButtonInner_hover","DialogButtonInner");}
this.IconButtonMouseOver=function(butId){var but=$GT(butId);but.className=but.className+"_hover";}
this.IconButtonMouseOut=function(butId){var but=$GT(butId);but.className=but.className.replace("_hover","");}
this.CloseDialog=function(){if(typeof(me.preCloseFunct)=='function'){var cont=me.preCloseFunct();}
if(cont==false){return(false);}
cont=me.CloseChildren();if(cont==false){return(false);}
me.unregisterDialog();topdia=me.getTopmostDialog(true);if(topdia!=null){var darkDiv=$GT('darkDiv');if(darkDiv){darkDiv.style.zIndex=topdia.zIndex;}}else{if(me.lightBox){me.RemoveDarkDiv();}}
me.RemoveDialogDiv();if(typeof(me.postCloseFunct)=='function'){me.postCloseFunct();}
this.DetatchFromParent();return(true);}
this.CloseChildren=function(){while(typeof(me.children[0])!='undefined'){var success=me.children[0].CloseDialog();if(!success){return(false);}}
return(true);}
this.MaximiseDialog=function(){this.updateWinDets();var hgt=(me._winDets.h)+"px";$GT(me.id).style.width="100%";$GT(me.id).style.height=hgt;this.IE6ZIndexBugFrameResize();var y=parseInt(me._winDets.y);$GT(me.id).style.left="0px";$GT(me.id).style.top=y+"px";$GT(me.id+"_maximise").style.display="none";$GT(me.id+"_minimise").style.display="";$GT(me.id+"_winDragExpContainer").style.display="none";$GT(me.id+"_inner").style.height=(parseInt($GT(me.id).offsetHeight)-parseInt($GT(me.id+"_toolBar").offsetHeight)-parseInt($GT(me.id+"_baseBar").offsetHeight))+"px";me.SetEdgeDims();if(typeof(me.postResizeFunct)=='function'){me.postResizeFunct();}}
this.MinimiseDialog=function(){$GT(me.id).style.width=me.w+"px";$GT(me.id).style.height=me.h+"px";$GT(me.id).style.left=me.x+"px";$GT(me.id).style.top=me.y+"px";$GT(me.id+"_minimise").style.display="none";$GT(me.id+"_maximise").style.display="";$GT(me.id+"_winDragExpContainer").style.display="";$GT(me.id+"_inner").style.height=(me.h-parseInt($GT(me.id+"_toolBar").offsetHeight)-parseInt($GT(me.id+"_baseBar").offsetHeight))+"px";me.SetEdgeDims();this.IE6ZIndexBugFrameResize();if(typeof(me.postResizeFunct)=='function'){me.postResizeFunct();}}
this.RemoveDialogDiv=function(){var div=me.domObj;div.style.visibility="hidden";try{var divParent=div.parentNode;divParent.removeChild(div);}catch(e){}}
this.RemoveDarkDiv=function(){if($GT('darkDiv')){$GT('darkDiv').style.visibility='hidden';document.body.removeChild($GT('darkDiv'));}}
this.SetPrompt=function(newPrompt){if(typeof(newPrompt)=="string"){$GT(me.id+"_prompt").innerHTML=newPrompt;}else{$GT(me.id+"_prompt").innerHTML='';$GT(me.id+"_prompt").appendChild(newPrompt);}}
this.SetTitle=function(newTitle){$GT(me.id+"_toolBarTitle").innerHTML=newTitle;}
this.StatusLoading=function(loadingText){if($GT(me.id+'_loader')){me.StatusLoadingRemove();}
var ldCont=GTLib.DOM.createEl('div',{id:this.id+'_loader','className':'mainLoader'});var ldTextNode=GTLib.DOM.createEl('div',{'style':'position:relative'});var ldImg=GTLib.DOM.createEl('div',{'className':'imgLoaderBar'});var ldText=loadingText?loadingText:this.ldText;ldTextNode.innerHTML=ldText;ldCont.appendChild(ldTextNode);ldCont.appendChild(ldImg,{});$GT(me.id+"_prompt").style.display='none';me.domObj.appendChild(ldCont);}
this.StatusLoadingRemove=function(){$GT(me.id+'_loader').parentNode.removeChild($GT(me.id+'_loader'));$GT(me.id+"_prompt").style.display='';}
this.RemoveButtons=function(){var butCont=$GT(this.id+'_buttonContainer');butCont.parentNode.removeChild(butCont);}
this.AddChildDialog=function(title,prompt,opts){var childNum=this.children.length;var opts=opts?opts:{};if(this.zIndex){opts.zIndex=this.zIndex+(this.children.length+1);}
var x=opts.x;var y=opts.y;var w=opts.w?opts.w:300;var h=opts.h?opts.h:200;var id=opts.id?opts.id:this.id+"_"+childNum;var lightbox=opts.lightbox?opts.lightbox:false;var tbButtons=opts.tbButtons?opts.tbButtons:{close:true,minmax:true};var buttons=opts.buttons?opts.buttons:[{}];var chPosOffset=10;if(x==null){var x=parseInt(YAHOO.util.Dom.getX(me.domObj))+(parseInt(me.domObj.offsetWidth/2)-parseInt(w/2))+(childNum*chPosOffset);}
if(y==null){var y=parseInt(YAHOO.util.Dom.getY(me.domObj))+(parseInt(me.domObj.offsetHeight/2)-parseInt(h/2))+(childNum*chPosOffset);}
opts.x=x;opts.y=y;var dg=new Dialog(title,prompt,opts);dg.id=id;dg.lightBox=lightbox;dg.tbButtons=tbButtons;var created=dg.Init();if(created){dg.parentDialog=me;this.children.push(dg);return(dg);}else{return(false);}}
this.DetatchFromParent=function(){if(me.parentDialog){var pKids=me.parentDialog.children;for(var p=0;p<pKids.length;p++){if(pKids[p].id==me.id){me.parentDialog.children.splice(p,1);return;}}}}
this.FixAllIEPngBGs=function(){this.FixIEPngBG($GT(me.id+"_t_edge"));this.FixIEPngBG($GT(me.id+"_r_edge"));this.FixIEPngBG($GT(me.id+"_b_edge"));this.FixIEPngBG($GT(me.id+"_l_edge"));this.FixIEPngBG($GT(me.id+"_tlcorner"));this.FixIEPngBG($GT(me.id+"_trcorner"));this.FixIEPngBG($GT(me.id+"_blcorner"));this.FixIEPngBG($GT(me.id+"_brcorner"));}
this.FixIEPngBG=function(elmnt){if((this.browser.ie6)&&(document.body.filters)){bkg=(elmnt.background?elmnt.background:(elmnt.style.backgroundImage?elmnt.style.backgroundImage:elmnt.currentStyle.backgroundImage));bkg=bkg.replace('url(','');bkg=bkg.replace(')','');while(bkg.indexOf('"')>-1){bkg=bkg.replace('"','');}
elmnt.style.backgroundImage="url(images/blank.gif)";elmnt.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+bkg+"', sizingMethod='scale');";}}
this.FixIE6FieldZIndexBug=function(){if(this.browser.ie6){var frame=GTLib.DOM.createEl('iframe',{id:this.id+'frame'});frame.style.position='absolute';frame.style.zIndex='0';frame.style.top='5px';frame.style.left='5px';var w=parseInt(this.domObj.style.width);var h=parseInt(this.domObj.style.height);frame.style.width=(w-10)+"px";frame.style.height=(h-10)+"px";frame.frameborder=0;this.domObj.appendChild(frame);}}
this.IE6ZIndexBugFrameResize=function(){if(this.browser.ie6){var w=this.domObj.offsetWidth>0?this.domObj.offsetWidth:this.domObj.style.width;var h=this.domObj.offsetHeight>0?this.domObj.offsetHeight:this.domObj.style.height;w=parseInt(w);h=parseInt(h);var frame=$GT(this.id+'frame');frame.style.width=(w-10)+"px";frame.style.height=(h-10)+"px";}}
var me=this;}
if(GTLib.ExportFuncs){moodle_get_string=GTLib.Moodle.get_string;Dialog=GTLib.Widget.Dialog;AJAJTree=GTLib.Widget.AJAJTree;}});